{% extends "brands/base_brand.html" %}
{% load static %}

{% block title %}Billing & Payments · Brand Dashboard · Push-it{% endblock %}

{% block breadcrumb %}Billing{% endblock %}

{% block brand_extra_styles %}
<style>
.billing-header {
    margin-bottom: 32px;
}

.billing-header h1 {
    font-size: 24px;
    font-weight: 700;
    margin: 0 0 8px 0;
    color: var(--foreground);
}

.billing-header h2 {
    font-size: 18px;
    font-weight: 600;
    margin: 0;
    color: var(--foreground);
}

.billing-header p {
    margin: 0;
    color: var(--muted-foreground);
    font-size: 14px;
}

.billing-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 24px;
    margin-bottom: 32px;
}

.card-panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    display: flex;
    flex-direction: column;
    height: 100%;
}

.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.panel-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--foreground);
}

.btn-secondary {
    background: var(--card);
    border: 1px solid var(--border);
    color: var(--foreground);
    padding: 8px 16px;
    border-radius: var(--radius-md);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: background 0.2s;
}

.btn-secondary:hover {
    background: var(--secondary);
}

.payment-method-card {
    display: flex;
    align-items: center;
    padding: 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    background: var(--background);
}

.card-icon {
    width: 48px;
    height: 32px;
    background: var(--secondary);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 16px;
    color: var(--muted-foreground);
}

.card-details {
    flex: 1;
}

.card-last4 {
    font-weight: 500;
    font-size: 14px;
    margin-bottom: 2px;
    color: var(--foreground);
}

.card-expiry {
    font-size: 12px;
    color: var(--muted-foreground);
}

.default-badge {
    background: var(--secondary);
    color: var(--secondary-foreground);
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 99px;
    font-weight: 600;
}

.spend-stat {
    margin-top: auto;
}

.spend-label {
    font-size: 13px;
    color: var(--muted-foreground);
    margin-bottom: 4px;
}

.spend-amount {
    font-size: 28px;
    font-weight: 700;
    letter-spacing: -0.5px;
    color: var(--foreground);
}

.spend-amount.secondary {
    font-size: 18px;
    color: var(--muted-foreground);
}

.invoices-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.invoices-table th {
    background: var(--secondary);
    color: var(--muted-foreground);
    font-weight: 500;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 12px 24px;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

.invoices-table td {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    font-size: 14px;
    color: var(--foreground);
    vertical-align: middle;
}

.invoices-table tr:last-child td {
    border-bottom: none;
}

.invoices-table tbody tr {
    cursor: pointer;
    transition: background 0.2s;
}

.invoices-table tbody tr:hover {
    background-color: var(--background);
}

.status-pill {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 99px;
    font-size: 12px;
    font-weight: 500;
}

.status-paid {
    background: var(--success);
    color: var(--success-foreground);
}

.status-pending {
    background: var(--warning);
    color: var(--warning-foreground);
}

.icon-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--muted-foreground);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4px;
    border-radius: var(--radius-md);
    transition: all 0.2s;
}

.icon-btn:hover {
    background: var(--secondary);
    color: var(--foreground);
}

@media (max-width: 1024px) {
    .billing-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .invoices-table {
        font-size: 12px;
    }
    
    .invoices-table th,
    .invoices-table td {
        padding: 12px;
    }
}
</style>
{% endblock %}

{% block brand_content %}
<div class="billing-header">
    <h1>Payment Methods</h1>
    <p>Manage your billing information and view transaction history.</p>
</div>

<!-- Grid: Payment Methods & Summary -->
<div class="billing-grid">
    <!-- Payment Methods -->
    <div class="card-panel">
        <div class="panel-header">
            <div class="panel-title">Saved Cards</div>
            <a href="{% url 'brands:add_payment_method' %}" class="btn-secondary">
                <iconify-icon icon="lucide:plus" style="font-size: 14px;"></iconify-icon>
                Add Method
            </a>
        </div>

        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for method in payment_methods %}
            <div class="payment-method-card">
                <div class="card-icon">
                    <iconify-icon icon="lucide:credit-card" style="font-size: 24px;"></iconify-icon>
                </div>
                <div class="card-details">
                    <div class="card-last4">
                        {% if method.type == 'visa' %}Visa{% elif method.type == 'mastercard' %}Mastercard{% else %}Card{% endif %} ending in {{ method.last4 }}
                    </div>
                    <div class="card-expiry">Expires {{ method.expiry }}</div>
                </div>
                {% if method.is_default %}
                <span class="default-badge">Default</span>
                {% endif %}
                <button class="icon-btn" style="margin-left: 12px;" title="More options">
                    <iconify-icon icon="lucide:more-horizontal" style="font-size: 16px;"></iconify-icon>
                </button>
            </div>
            {% empty %}
            <div style="padding: 24px; text-align: center; color: var(--muted-foreground);">
                <p>No payment methods added yet.</p>
                <a href="{% url 'brands:add_payment_method' %}" class="btn-secondary" style="margin-top: 12px;">
                    <iconify-icon icon="lucide:plus" style="font-size: 14px;"></iconify-icon>
                    Add Payment Method
                </a>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Spending Summary -->
    <div class="card-panel">
        <div class="panel-header">
            <div class="panel-title">Total Spend</div>
        </div>
        <div class="spend-stat">
            <div class="spend-label">This Month</div>
            <div class="spend-amount">{{ currency_symbol }}{{ spending.this_month|floatformat:2 }}</div>
        </div>
        <div class="spend-stat" style="margin-top: 16px;">
            <div class="spend-label">Lifetime</div>
            <div class="spend-amount secondary">{{ currency_symbol }}{{ spending.lifetime|floatformat:2 }}</div>
        </div>
    </div>
</div>

<!-- Invoices Table -->
<div class="billing-header" style="margin-top: 48px; margin-bottom: 24px;">
    <h2 class="panel-title">Invoice History</h2>
</div>

{% if invoices %}
<table class="invoices-table">
    <thead>
        <tr>
            <th style="width: 20%;">Date</th>
            <th style="width: 35%;">Description</th>
            <th style="width: 15%;">Amount</th>
            <th style="width: 15%;">Status</th>
            <th style="width: 15%; text-align: right;">Invoice</th>
        </tr>
    </thead>
    <tbody>
        {% for invoice in invoices %}
        <tr>
            <td>{{ invoice.date|date:"M d, Y" }}</td>
            <td style="font-weight: 500;">{{ invoice.description }}</td>
            <td>{{ currency_symbol }}{{ invoice.amount|floatformat:2 }}</td>
            <td>
                <span class="status-pill status-{{ invoice.status }}">
                    {% if invoice.status == 'paid' %}Paid{% else %}Pending{% endif %}
                </span>
            </td>
            <td style="text-align: right;">
                <button class="icon-btn" title="Download invoice">
                    <iconify-icon icon="lucide:download" style="font-size: 16px;"></iconify-icon>
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="card-panel" style="text-align: center; padding: 48px;">
    <iconify-icon icon="lucide:file-text" style="font-size: 48px; color: var(--muted-foreground); margin-bottom: 16px;"></iconify-icon>
    <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 8px 0; color: var(--foreground);">No invoices yet</h3>
    <p style="color: var(--muted-foreground); margin: 0;">Invoices will appear here once you top up your wallet or create campaigns.</p>
</div>
{% endif %}
{% endblock %}

