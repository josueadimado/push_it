{% extends "brands/base_brand.html" %}
{% load static %}
{% load humanize %}

{% block title %}Wallet · Brand Dashboard · Push-it{% endblock %}

{% block breadcrumb %}Wallet{% endblock %}

{% block brand_extra_styles %}
<style>
.wallet-container {
    max-width: 1000px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 32px;
}

.section-header {
    margin-bottom: 24px;
}

.section-title {
    font-size: 20px;
    font-weight: 600;
    margin: 0 0 8px 0;
    color: var(--foreground);
}

.section-desc {
    color: var(--muted-foreground);
    font-size: 14px;
    margin: 0;
}

.wallet-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    margin-bottom: 32px;
}

.card-panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    overflow: hidden;
}

.balance-card {
    background: linear-gradient(135deg, var(--primary) 0%, #4338ca 100%);
    color: var(--primary-foreground);
    border: none;
}

.balance-label {
    font-size: 14px;
    opacity: 0.9;
    margin-bottom: 12px;
    font-weight: 500;
}

.balance-amount {
    font-size: 48px;
    font-weight: 700;
    margin: 0 0 8px 0;
    color: var(--primary-foreground);
    line-height: 1;
}

.balance-subtitle {
    font-size: 14px;
    opacity: 0.9;
    margin: 0;
}

.top-up-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--foreground);
}

.form-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    background: var(--background);
    font-size: 15px;
    color: var(--foreground);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.quick-amounts {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-top: 8px;
}

.quick-amount-btn {
    padding: 10px;
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    background: var(--background);
    color: var(--foreground);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.quick-amount-btn:hover {
    background: var(--secondary);
    border-color: var(--primary);
}

.btn-primary {
    background: var(--primary);
    color: var(--primary-foreground);
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-primary:hover {
    opacity: 0.9;
}

.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.info-card {
    background: var(--secondary);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 16px;
    margin-top: 16px;
}

.info-card p {
    font-size: 13px;
    color: var(--muted-foreground);
    margin: 0 0 8px 0;
    line-height: 1.5;
}

.info-card ul {
    margin: 0;
    padding-left: 20px;
    font-size: 13px;
    color: var(--muted-foreground);
}

.info-card li {
    margin-bottom: 4px;
}

.ready-section {
    background: var(--success);
    border: 1px solid var(--success-foreground);
    border-color: rgba(22, 101, 52, 0.2);
}

.ready-section .section-title {
    color: var(--success-foreground);
}

.ready-section p {
    color: var(--success-foreground);
    opacity: 0.9;
}

.btn-success {
    background: var(--success-foreground);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-success:hover {
    opacity: 0.9;
}

@media (max-width: 1024px) {
    .wallet-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block brand_content %}
<div class="wallet-container">
    <!-- Page Header -->
    <div class="section-header">
        <h2 class="section-title">Wallet</h2>
        <div class="section-desc">
            Top up your wallet to create and launch campaigns for influencers.
        </div>
    </div>

    {% if messages %}
        <div style="margin-bottom: 24px; display: flex; flex-direction: column; gap: 12px;">
            {% for message in messages %}
                <div style="padding: 14px 18px; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-md); color: var(--foreground) !important; display: flex; align-items: center; gap: 10px;">
                    <iconify-icon icon="lucide:{% if message.tags == 'error' %}alert-circle{% else %}check-circle{% endif %}" style="font-size: 18px; color: {% if message.tags == 'error' %}var(--destructive){% else %}var(--success-foreground){% endif %}; flex-shrink: 0;"></iconify-icon>
                    <span>{{ message }}</span>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="wallet-grid">
        <!-- Balance Card -->
        <div class="card-panel balance-card">
            <div class="balance-label">Current Balance</div>
            <div class="balance-amount">{{ currency_symbol }}{{ wallet_balance|floatformat:2 }}</div>
            <p class="balance-subtitle">
                Available for campaign creation
            </p>
            {% if currency %}
            <p style="font-size: 12px; opacity: 0.8; margin-top: 8px; margin-bottom: 0;">
                Currency: {{ currency.name }} ({{ currency.code }})
            </p>
            {% endif %}
        </div>

        <!-- Top Up Form -->
        <div class="card-panel">
            <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 20px 0; color: var(--foreground);">
                Top Up Wallet
            </h3>
            
            <form method="post" class="top-up-form" action="{% url 'brands:wallet' %}">
                {% csrf_token %}
                <input type="hidden" name="top_up" value="1">
                
                <div class="form-group">
                    <label class="form-label">Amount ({{ currency_code }})</label>
                    <input 
                        type="number" 
                        name="amount" 
                        class="form-input" 
                        placeholder="0.00" 
                        step="0.01" 
                        min="1" 
                        required
                        id="amountInput"
                    >
                    
                    <div class="quick-amounts">
                        <button type="button" class="quick-amount-btn" onclick="setAmount(1000)">{{ currency_symbol }}1,000</button>
                        <button type="button" class="quick-amount-btn" onclick="setAmount(5000)">{{ currency_symbol }}5,000</button>
                        <button type="button" class="quick-amount-btn" onclick="setAmount(10000)">{{ currency_symbol }}10,000</button>
                        <button type="button" class="quick-amount-btn" onclick="setAmount(25000)">{{ currency_symbol }}25,000</button>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary">
                    <iconify-icon icon="lucide:credit-card" style="font-size: 18px;"></iconify-icon>
                    Pay with Paystack
                </button>
            </form>
            
            <div style="margin-top: 16px; padding: 12px; background: var(--secondary); border-radius: var(--radius-md); display: flex; align-items: center; gap: 8px;">
                <iconify-icon icon="lucide:shield-check" style="font-size: 16px; color: var(--success-foreground);"></iconify-icon>
                <span style="font-size: 12px; color: var(--muted-foreground);">
                    Secure payment powered by Paystack
                </span>
            </div>
        </div>
    </div>
    
    <!-- Recent Transactions -->
    {% if recent_transactions %}
    <section>
        <div class="section-header">
            <h2 class="section-title">Recent Transactions</h2>
            <div class="section-desc">
                Your recent wallet top-up transactions.
            </div>
        </div>
        <div class="card-panel">
            <div style="display: flex; flex-direction: column; gap: 12px;">
                {% for transaction in recent_transactions %}
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--secondary); border-radius: var(--radius-md);">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 4px; color: var(--foreground);">
                            {{ transaction.get_payment_type_display }}
                        </div>
                        <div style="font-size: 12px; color: var(--muted-foreground);">
                            {{ transaction.created_at|date:"M d, Y h:i A" }}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600; color: var(--foreground);">
                            {{ currency_symbol }}{{ transaction.amount|floatformat:2 }}
                        </div>
                        <div style="font-size: 12px;">
                            {% if transaction.status == 'success' %}
                                <span style="color: var(--success-foreground);">✓ Completed</span>
                            {% elif transaction.status == 'pending' %}
                                <span style="color: var(--warning-foreground);">⏳ Pending</span>
                            {% elif transaction.status == 'failed' %}
                                <span style="color: var(--destructive-foreground);">✗ Failed</span>
                            {% else %}
                                <span style="color: var(--muted-foreground);">{{ transaction.get_status_display }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- How It Works -->
    <section>
        <div class="section-header">
            <h2 class="section-title">How It Works</h2>
            <div class="section-desc">
                Understanding the wallet system and campaign payments.
            </div>
        </div>
        <div class="card-panel">
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <div style="display: flex; align-items: start; gap: 12px;">
                    <div style="width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-weight: 600; font-size: 14px;">1</div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px; color: var(--foreground);">Top Up Your Wallet</div>
                        <div style="font-size: 13px; color: var(--muted-foreground);">Add funds to your wallet with any amount. You can top up anytime.</div>
                    </div>
                </div>
                <div style="display: flex; align-items: start; gap: 12px;">
                    <div style="width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-weight: 600; font-size: 14px;">2</div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px; color: var(--foreground);">Create Campaigns</div>
                        <div style="font-size: 13px; color: var(--muted-foreground);">Use your wallet balance to create and launch campaigns for influencers.</div>
                    </div>
                </div>
                <div style="display: flex; align-items: start; gap: 12px;">
                    <div style="width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-weight: 600; font-size: 14px;">3</div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px; color: var(--foreground);">Automatic Deduction</div>
                        <div style="font-size: 13px; color: var(--muted-foreground);">Campaign budget is automatically deducted from your wallet when you create a campaign.</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {% if wallet_balance > 0 %}
    <!-- Ready to Create Campaigns -->
    <section>
        <div class="card-panel ready-section">
            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
                <div>
                    <h3 class="section-title" style="margin: 0 0 8px 0;">Ready to Create Campaigns</h3>
                    <p style="margin: 0; font-size: 14px;">
                        You have sufficient balance to start creating campaigns. Click below to get started!
                    </p>
                </div>
                <a href="{% url 'brands:campaigns' %}" class="btn-success">
                    <iconify-icon icon="lucide:plus" style="font-size: 18px;"></iconify-icon>
                    Create Campaign
                </a>
            </div>
        </div>
    </section>
    {% endif %}
</div>

<script>
function setAmount(amount) {
    document.getElementById('amountInput').value = amount;
}
</script>
{% endblock %}

