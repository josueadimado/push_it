{% extends "influencers/base_influencer.html" %}

{% block title %}Wallet Â· Push-it{% endblock %}

{% block breadcrumb %}Wallet{% endblock %}

{% block inf_extra_styles %}
<style>
/* Ensure all text uses theme colors */
.content * {
    color: inherit;
}

/* Page Header */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.page-title {
    font-size: 24px;
    font-weight: 600;
    color: var(--foreground);
    margin: 0;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 24px;
}

.stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
}

.stat-card.highlight {
    border-color: var(--primary); /* Orange border for highlight */
    background: hsl(222 47% 8%) !important; /* Explicit dark background for dark mode */
}

/* Ensure all text in highlight card is visible in dark mode */
.stat-card.highlight .stat-label,
.stat-card.highlight .stat-value,
.stat-card.highlight .stat-sub {
    color: inherit !important;
}

html.light .stat-card.highlight {
    background: linear-gradient(to bottom right, #ffffff, #f8fafc) !important;
}

.stat-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--muted-foreground) !important;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--foreground) !important;
    letter-spacing: -0.5px;
}

.stat-sub {
    font-size: 13px;
    color: var(--muted-foreground) !important;
    margin-top: 8px;
}

.withdraw-btn {
    margin-top: 16px;
    background: var(--primary);
    color: var(--primary-foreground);
    border: none;
    border-radius: var(--radius-md);
    padding: 10px;
    font-weight: 500;
    cursor: pointer;
    font-size: 14px;
    width: 100%;
}

.withdraw-btn:hover {
    opacity: 0.9;
}

/* Layout Grid */
.split-layout {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 24px;
}

.card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    margin-bottom: 24px;
}

.card:last-child {
    margin-bottom: 0;
}

.card-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-weight: 600;
    font-size: 15px;
    color: var(--foreground) !important; /* Ensure text is visible */
}

.card-body {
    padding: 0;
}

/* Table */
.transaction-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

.transaction-table th {
    text-align: left;
    padding: 12px 20px;
    background: var(--secondary); /* Cyan background */
    color: #ffffff !important; /* White text on cyan background for visibility */
    font-weight: 500;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Subtle border */
}

/* Light mode: darker text on lighter cyan background */
html.light .transaction-table th {
    color: #0f172a !important; /* Dark text for light mode */
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.transaction-table td {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    color: var(--foreground) !important;
}

.transaction-table tr:last-child td {
    border-bottom: none;
}

.transaction-table tr:hover td {
    background-color: rgba(0, 0, 0, 0.01);
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 500;
}

.status-completed {
    background: var(--success);
    color: var(--success-foreground);
}

.status-pending {
    background: var(--warning);
    color: var(--warning-foreground);
}

.status-processing {
    background: var(--secondary); /* Cyan background */
    color: #ffffff !important; /* White text for visibility */
}

html.light .status-processing {
    color: #0f172a !important; /* Dark text for light mode */
}

.amount-plus {
    color: #166534;
    font-weight: 600;
}

.amount-minus {
    color: var(--foreground);
    font-weight: 600;
}

/* Payment Methods */
.method-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
}

.method-item:last-child {
    border-bottom: none;
}

.method-icon {
    width: 40px;
    height: 40px;
    background: rgba(16, 183, 214, 0.15); /* Cyan tint instead of solid */
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #0ea5c0 !important; /* Darker cyan icon */
}

html.light .method-icon {
    color: #0891b2 !important;
}

.method-details {
    flex: 1;
}

.method-name {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 2px;
    color: var(--foreground) !important;
}

.method-meta {
    font-size: 12px;
    color: var(--muted-foreground) !important;
}

.edit-btn {
    font-size: 13px;
    color: var(--primary);
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.edit-btn:hover {
    text-decoration: underline;
}

.info-box {
    padding: 20px;
    background: var(--muted);
    border-radius: var(--radius-lg);
    font-size: 13px;
    color: var(--muted-foreground) !important;
    line-height: 1.5;
}

.info-box strong {
    color: var(--foreground) !important;
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 8px;
}

/* Responsive */
@media (max-width: 1024px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
    .split-layout {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block inf_content %}
<div class="page-header">
    <h1 class="page-title">My Wallet</h1>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card highlight">
        <div class="stat-label">
            <iconify-icon icon="lucide:wallet-cards" style="font-size: 16px;"></iconify-icon>
            Available to withdraw
        </div>
        <div class="stat-value">{{ currency_symbol }}{{ available_balance|floatformat:2 }}</div>
        <div class="stat-sub">From {{ available_count }} completed job{{ available_count|pluralize }}</div>
        {% if available_balance >= 50 %}
            <form method="post" action="{% url 'influencers:request_withdrawal' %}" style="margin-top: 16px;">
                {% csrf_token %}
                <button type="submit" class="withdraw-btn">Request withdrawal</button>
            </form>
        {% elif available_balance > 0 %}
            <button class="withdraw-btn" disabled style="opacity: 0.5; cursor: not-allowed;">
                Min. {{ currency_symbol }}50.00 required
            </button>
        {% else %}
            <div class="stat-sub" style="margin-top: 16px; color: var(--muted-foreground) !important;">
                Complete jobs to earn money
            </div>
        {% endif %}
    </div>

    <div class="stat-card">
        <div class="stat-label">
            <iconify-icon icon="lucide:hourglass" style="font-size: 16px;"></iconify-icon>
            Pending clearance
        </div>
        <div class="stat-value">{{ currency_symbol }}{{ pending_clearance_amount|floatformat:2 }}</div>
        <div class="stat-sub">From jobs in progress</div>
        <div class="stat-sub" style="margin-top: 4px; font-size: 12px; color: var(--muted-foreground) !important;">
            Will be available after job completion
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-label">
            <iconify-icon icon="lucide:piggy-bank" style="font-size: 16px;"></iconify-icon>
            Lifetime earnings
        </div>
        <div class="stat-value">{{ currency_symbol }}{{ total_earned|floatformat:2 }}</div>
        <div class="stat-sub">{{ sent_count }} payout{{ sent_count|pluralize }} completed</div>
    </div>
</div>

<!-- Main Layout Split -->
<div class="split-layout">
    <!-- Left: Transaction History -->
    <div class="section-main">
        <div class="card">
            <div class="card-header">
                Payment History
                <div style="display: flex; gap: 8px;">
                    <a href="{% url 'influencers:wallet' %}?status=all" 
                       class="edit-btn {% if status_filter == 'all' %}{% endif %}" 
                       style="text-decoration: none;">
                        All
                    </a>
                    <a href="{% url 'influencers:wallet' %}?status=pending" 
                       class="edit-btn {% if status_filter == 'pending' %}{% endif %}" 
                       style="text-decoration: none;">
                        Pending
                    </a>
                    <a href="{% url 'influencers:wallet' %}?status=sent" 
                       class="edit-btn {% if status_filter == 'sent' %}{% endif %}" 
                       style="text-decoration: none;">
                        Sent
                    </a>
                    <a href="{% url 'influencers:wallet' %}?status=available" 
                       class="edit-btn {% if status_filter == 'available' %}{% endif %}" 
                       style="text-decoration: none;">
                        Available
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if payouts %}
                    <table class="transaction-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Campaign</th>
                                <th>Status</th>
                                <th style="text-align: right;">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payout in payouts %}
                                <tr>
                                    <td>
                                        {% if payout.sent_at %}
                                            {{ payout.sent_at|date:"M d, Y" }}
                                        {% elif payout.due_date %}
                                            Due: {{ payout.due_date|date:"M d, Y" }}
                                        {% else %}
                                            {{ payout.created_at|date:"M d, Y" }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div style="font-weight: 500; color: var(--foreground) !important;">
                                            {{ payout.campaign.name }}
                                        </div>
                                        <div style="font-size: 12px; color: var(--muted-foreground) !important;">
                                            {{ payout.campaign.brand.company_name }}
                                        </div>
                                    </td>
                                    <td>
                                        {% if payout.status == 'sent' %}
                                            <span class="status-badge status-completed">Paid</span>
                                        {% elif payout.status == 'pending' %}
                                            {% if payout.is_overdue %}
                                                <span class="status-badge" style="background: var(--destructive); color: var(--destructive-foreground);">
                                                    Overdue
                                                </span>
                                            {% else %}
                                                <span class="status-badge status-processing">Pending</span>
                                            {% endif %}
                                        {% elif payout.status == 'failed' %}
                                            <span class="status-badge" style="background: var(--destructive); color: var(--destructive-foreground);">
                                                Failed
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="amount-plus" style="text-align: right; font-weight: 600;">
                                        {{ currency_symbol }}{{ payout.amount|floatformat:2 }}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div style="text-align: center; padding: 60px 20px; color: var(--muted-foreground) !important;">
                        <iconify-icon icon="lucide:wallet" style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;"></iconify-icon>
                        <h3 style="font-size: 18px; font-weight: 600; color: var(--foreground) !important; margin-bottom: 8px;">
                            No payouts yet
                        </h3>
                        <p style="font-size: 14px;">
                            {% if status_filter != 'all' %}
                                No payouts with this status. <a href="{% url 'influencers:wallet' %}">View all payouts</a>
                            {% else %}
                                Complete jobs and get verified to receive payouts.
                            {% endif %}
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Right: Payment Methods & Info -->
    <div class="section-side">
        <div class="card">
            <div class="card-header">
                Payment Methods
                <a href="{% url 'influencers:add_payment_method' %}" class="edit-btn">Add Method</a>
            </div>
            <div class="card-body">
                {% if payment_methods %}
                    {% for method in payment_methods %}
                        <div class="method-item">
                            <div class="method-icon">
                                {% if method.method_type == 'bank' %}
                                    <iconify-icon icon="lucide:landmark" style="font-size: 20px;"></iconify-icon>
                                {% elif method.method_type == 'momo' %}
                                    <iconify-icon icon="lucide:smartphone" style="font-size: 20px;"></iconify-icon>
                                {% else %}
                                    <iconify-icon icon="lucide:credit-card" style="font-size: 20px;"></iconify-icon>
                                {% endif %}
                            </div>
                            <div class="method-details">
                                <div class="method-name">
                                    {{ method.get_display_name }}
                                    {% if method.is_default %}
                                        <span style="font-size: 11px; color: var(--primary); font-weight: 600;">(Default)</span>
                                    {% endif %}
                                </div>
                                <div class="method-meta">{{ method.get_details_summary }}</div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                {% if not method.is_default %}
                                    <form method="post" action="{% url 'influencers:set_default_payment_method' method.id %}" style="display: inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn-link" style="font-size: 12px; padding: 4px 8px;" title="Set as default">Set Default</button>
                                    </form>
                                {% endif %}
                                <a href="{% url 'influencers:edit_payment_method' method.id %}" class="btn-link" style="font-size: 12px; padding: 4px 8px;">Edit</a>
                                <form method="post" action="{% url 'influencers:delete_payment_method' method.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this payment method?');">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-link" style="font-size: 12px; padding: 4px 8px; color: var(--destructive);">Delete</button>
                                </form>
                                {% if method.is_default %}
                                    <iconify-icon icon="lucide:check-circle" style="font-size: 18px; color: #22c55e;"></iconify-icon>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div style="text-align: center; padding: 24px; color: var(--muted-foreground);">
                        <iconify-icon icon="lucide:credit-card-off" style="font-size: 32px; margin-bottom: 8px;"></iconify-icon>
                        <p style="margin: 8px 0;">No payment methods added</p>
                        <a href="{% url 'influencers:add_payment_method' %}" class="btn-primary" style="display: inline-block; margin-top: 8px;">Add Payment Method</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="info-box">
            <strong>
                <iconify-icon icon="lucide:info" style="font-size: 14px;"></iconify-icon>
                Withdrawal Rules
            </strong>
            Standard withdrawals take 1-3 business days. Express options may be available for a fee. Ensure your tax information is up to date in Profile settings to avoid delays.
        </div>
    </div>
</div>
{% endblock %}
